# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.
### Ответ

Компоненты решения:
1. GitLab (облачная версия или self-hosted) – единая платформа для:
- Хранения кода (Git-репозитории)
- CI/CD (GitLab CI/CD)
- Управления секретами (Vault-интеграция или Protected Variables)
- Шаблонов сборки (Includes, Parent-Child Pipelines)
- Запуска сборок (триггеры по push/merge или через API)
2. GitLab Runner – агенты для выполнения сборки:
- Поддержка Docker, Kubernetes, Shell, SSH
- Возможность развертывания на собственных серверах
- Параллельные сборки.
3. Docker Registry для хранение кастомных образов для сборки.

|Требование|Реализация в GitLab|
|------------|-----------------------------------------------------------------------------------|
|Облачная система	|GitLab SaaS (gitlab.com)|
|Git-репозитории	|Встроенный Git с репозиториями на каждый сервис|
|Запуск сборки по событию		|Триггеры через git push, Webhooks, Merge Requests |
|Запуск сборки по кнопке		|Manual Jobs|
|Настройки на сборку		|Переменные CI/CD |
|Шаблоны сборок		|Reusable Templates, Parent-Child Pipelines, include в .gitlab-ci.yml|
|Хранение секретов	|Protected Variables, HashiCorp Vault-интеграция, CI/CD Masked Variables|
|Кастомные шаги			|Есть|
|Собственные Docker-образы		|Есть|
|Собственные агенты		|GitLab Runner на своих серверах|
|Параллельные сборки			|Есть|
|Параллельные тесты		|Есть|

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.
### Ответ
Реализация:
1. Fluent Bit, как агент
2. Kafka, как брокер
3. Elasticsearch используем как хранилище
4. Kibana используем для анализа логов

   
|Требование|Реализация|
|------------|-----------------------------------------------------------------------------------|
|Сбор логов с хостов	|Fluent Bit |
|Минимальные требования	|Приложения пишут логи в stdout, Fluent Bit собирает их без модификации кода|
|Гарантированная доставка	|Kafka и Fluent Bit |
|Поиск и фильтрация		|Elasticsearch  и Kibana |
|Доступ для разработчиков	|Kibana предоставляет RBAC и сохраненные поиски |
|Ссылки на поисковые запросы	|в Kibana можно делиться URL с параметрами поиска |
## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

### Ответ
Реализация:
1. Prometheus для сбора метрик
2. Grafana для визуализации
3. Alertmanager для оповещения


|Требование|Реализация|
|------------|-----------------------------------------------------------------------------------|
|Сбор метрик с хостов	|в Prometheus применяем Node Exporter для сборки данных CPU, RAM, дисков, сети|
|Метрики ресурсов сервисов	|через экспортеры в Prometheus|
|Специфичные метрики сервисов	|Prometheus SDK|
|Пользовательский интерфейс	|Grafana с поддержкой PromQL, создание необходимых дашбордов|
|Настройка панелей	|в Grafana есть готовые шаблоны плюс можно создать кастомные графики |


